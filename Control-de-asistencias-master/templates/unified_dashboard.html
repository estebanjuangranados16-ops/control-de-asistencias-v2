<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Asistencia Unificado</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
        }
        
        .header { 
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); 
            color: white; 
            padding: 2rem 0;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .header-content { max-width: 1600px; margin: 0 auto; padding: 0 2rem; }
        .header h1 { text-align: center; margin-bottom: 1rem; font-size: 2.5rem; font-weight: 300; }
        .datetime { text-align: center; font-size: 1.1rem; margin: 1rem 0; opacity: 0.9; }
        .status-bar { display: flex; justify-content: center; gap: 3rem; font-size: 1rem; }
        .status-item { display: flex; align-items: center; gap: 0.75rem; }
        .status-dot { width: 12px; height: 12px; border-radius: 50%; box-shadow: 0 0 10px rgba(255,255,255,0.3); }
        .connected { background: #10b981; }
        .disconnected { background: #ef4444; }
        .monitoring { background: #f59e0b; }
        
        .container { max-width: 1600px; margin: 0 auto; padding: 3rem 2rem; }
        .controls { 
            display: flex; 
            gap: 1.5rem; 
            margin-bottom: 3rem; 
            flex-wrap: wrap;
            justify-content: center;
        }
        .btn { 
            padding: 1rem 2rem; 
            border: none; 
            border-radius: 12px; 
            cursor: pointer; 
            font-weight: 600; 
            font-size: 0.95rem;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn-primary { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; }
        .btn-success { background: linear-gradient(135deg, #10b981, #059669); color: white; }
        .btn-warning { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
        .btn-danger { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }
        .btn-info { background: linear-gradient(135deg, #06b6d4, #0891b2); color: white; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
        
        .dashboard-grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 2rem; 
            margin-bottom: 3rem;
            min-height: 450px;
        }
        
        .employee-status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .card { 
            background: white; 
            padding: 2rem; 
            border-radius: 20px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s;
        }
        .card:hover { transform: translateY(-5px); box-shadow: 0 20px 60px rgba(0,0,0,0.15); }
        .card h3 { 
            color: #1e293b; 
            margin-bottom: 1.5rem; 
            display: flex; 
            align-items: center; 
            gap: 0.75rem;
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .stat-card { text-align: center; }
        .stat-number { 
            font-size: 4rem; 
            font-weight: 700; 
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }
        .stat-label { color: #64748b; font-size: 1.1rem; font-weight: 500; }
        
        .employee-list { max-height: 350px; overflow-y: auto; }
        .employee-item { 
            padding: 1rem; 
            border-bottom: 1px solid #f1f5f9; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            transition: all 0.2s;
        }
        .employee-item:hover { background: #f8fafc; }
        .employee-item:last-child { border-bottom: none; }
        .employee-name { font-weight: 600; font-size: 1rem; }
        .employee-time { color: #64748b; font-size: 0.9rem; }
        .status-inside { color: #10b981; }
        .status-outside { color: #ef4444; }
        
        .records-container { 
            background: white; 
            border-radius: 20px; 
            padding: 2rem; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            grid-column: 1 / -1;
        }
        .records-list { max-height: 500px; overflow-y: auto; }
        .record-item { 
            padding: 1.5rem; 
            border-bottom: 1px solid #f1f5f9; 
            transition: all 0.3s;
            border-radius: 12px;
            margin-bottom: 0.5rem;
        }
        .record-item:hover { background: #f8fafc; transform: translateX(5px); }
        .record-item.new-record { 
            animation: highlight 3s ease-out;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.2);
        }
        
        @keyframes highlight {
            0% { background: linear-gradient(135deg, #dbeafe, #bfdbfe); transform: scale(1.02); }
            100% { background: transparent; transform: scale(1); }
        }
        
        .record-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 0.75rem;
        }
        .record-name { 
            font-weight: 700; 
            color: #1e293b; 
            font-size: 1.1rem;
        }
        .record-event { 
            padding: 0.5rem 1rem; 
            border-radius: 25px; 
            font-size: 0.9rem; 
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .record-details { 
            color: #64748b; 
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; backdrop-filter: blur(5px); }
        .modal-content { background: white; margin: 3% auto; padding: 3rem; border-radius: 20px; max-width: 600px; box-shadow: 0 25px 80px rgba(0,0,0,0.3); }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.75rem; font-weight: 600; color: #374151; }
        .form-control { width: 100%; padding: 1rem; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 1rem; transition: all 0.3s; }
        .form-control:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        .checkbox-group { display: flex; align-items: center; gap: 0.75rem; }
        
        .notification { 
            position: fixed; 
            top: 30px; 
            right: 30px; 
            padding: 1.5rem 2rem; 
            border-radius: 15px; 
            color: white; 
            z-index: 1001;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-width: 400px;
            font-weight: 600;
        }
        .notification.success { background: linear-gradient(135deg, #10b981, #059669); }
        .notification.error { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .notification.info { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        
        @keyframes slideIn {
            from { transform: translateX(100%) scale(0.8); opacity: 0; }
            to { transform: translateX(0) scale(1); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0) scale(1); opacity: 1; }
            to { transform: translateX(100%) scale(0.8); opacity: 0; }
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .dashboard-grid { grid-template-columns: 1fr 1fr; }
            .employee-status-grid { grid-template-columns: 1fr; }
        }
        
        @media (max-width: 768px) {
            .dashboard-grid { grid-template-columns: 1fr; }
            .employee-status-grid { grid-template-columns: 1fr; }
            .container { padding: 2rem 1rem; }
            .header h1 { font-size: 2rem; }
            .controls { justify-content: center; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>üè¢ Sistema de Asistencia Empresarial</h1>
            <div class="datetime" id="currentDateTime"></div>
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-dot" id="connectionStatus"></div>
                    <span id="connectionText">Verificando conexi√≥n...</span>
                </div>
                <div class="status-item">
                    <div class="status-dot" id="monitoringStatus"></div>
                    <span id="monitoringText">Estado del monitoreo</span>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="controls">
            <button class="btn btn-primary" onclick="showAddEmployeeModal()">üë§ Agregar Empleado</button>
            <button class="btn btn-success" onclick="syncEmployees()">üîÑ Sincronizar desde Dispositivo</button>
            <button class="btn btn-warning" onclick="toggleMonitoring()" id="monitorBtn">‚è∏Ô∏è Detener Monitoreo</button>
            <button class="btn btn-primary" onclick="testConnection()">üîó Probar Conexi√≥n</button>
            <a href="/employees" class="btn btn-primary">üìã Gestionar Empleados</a>
            <a href="/reports" class="btn btn-info" style="background: #17a2b8;">üìà Reportes</a>
            <a href="/schedules" class="btn btn-info" style="background: #6f42c1;">üï∞Ô∏è Horarios</a>
        </div>

        <div class="dashboard-grid">
            <div class="card stat-card">
                <h3>üìä Registros Hoy</h3>
                <div class="stat-number" id="totalRecords">0</div>
                <div class="stat-label">Total de marcajes</div>
            </div>
            
            <div class="card stat-card">
                <h3>üë• Empleados</h3>
                <div class="stat-number" id="uniqueEmployees">0</div>
                <div class="stat-label">Activos hoy</div>
            </div>
            
            <div class="card stat-card">
                <h3>‚è∞ Hora Actual</h3>
                <div class="stat-number" id="currentTime" style="font-size: 2.5rem;">--:--</div>
                <div class="stat-label" id="currentDate">Cargando...</div>
            </div>
        </div>
        
        <div class="employee-status-grid">
            <div class="card">
                <h3>üü¢ Empleados Dentro (<span id="insideCount">0</span>)</h3>
                <div class="employee-list" id="employeesInside">
                    <div class="employee-item">Cargando...</div>
                </div>
            </div>

            <div class="card">
                <h3>üî¥ Empleados Fuera (<span id="outsideCount">0</span>)</h3>
                <div class="employee-list" id="employeesOutside">
                    <div class="employee-item">Cargando...</div>
                </div>
            </div>
        </div>

        <div class="records-container">
            <h3 style="font-size: 1.5rem; margin-bottom: 2rem; color: #1e293b;">üìã Registros en Tiempo Real</h3>
            <div class="records-list" id="recordsList">
                <div class="record-item" style="text-align: center; color: #64748b; font-size: 1.1rem;">
                    üïê Esperando registros de asistencia...
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Agregar Empleado -->
    <div class="modal" id="addEmployeeModal">
        <div class="modal-content">
            <h3>üë§ Agregar Nuevo Empleado</h3>
            <form id="addEmployeeForm">
                <div class="form-group">
                    <label>ID del Empleado *</label>
                    <input type="text" class="form-control" id="employeeId" required>
                </div>
                <div class="form-group">
                    <label>Nombre Completo *</label>
                    <input type="text" class="form-control" id="employeeName" required>
                </div>
                <div class="form-group">
                    <label>Departamento</label>
                    <input type="text" class="form-control" id="employeeDept" value="General">
                </div>
                <div class="form-group">
                    <label>Tel√©fono</label>
                    <input type="text" class="form-control" id="employeePhone">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" class="form-control" id="employeeEmail">
                </div>
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="syncToDevice" checked>
                        <label for="syncToDevice">Sincronizar con dispositivo Hikvision</label>
                    </div>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="submit" class="btn btn-success">‚úÖ Agregar</button>
                    <button type="button" class="btn btn-danger" onclick="closeModal()">‚ùå Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const socket = io();
        let isMonitoring = true;

        // Conectar a WebSocket
        socket.on('connect', function() {
            console.log('Conectado al servidor');
            loadDashboardData();
        });

        // Escuchar eventos en tiempo real
        socket.on('attendance_record', function(data) {
            addNewRecord(data);
            loadDashboardData(); // Actualizar estad√≠sticas
        });

        socket.on('access_denied', function(data) {
            addDeniedRecord(data);
            showNotification(`‚ùå ${data.message}`, 'error');
        });

        socket.on('dashboard_update', function(data) {
            updateDashboardWithData(data);
        });

        socket.on('connection_restored', function(data) {
            showNotification('üîó Conexi√≥n con dispositivo restaurada', 'success');
            loadDashboardData();
        });

        socket.on('employee_added', function(data) {
            showNotification(`Empleado ${data.name} agregado ${data.synced ? 'y sincronizado' : ''}`, 'success');
            loadDashboardData();
        });

        function loadDashboardData() {
            fetch('/api/dashboard')
                .then(response => response.json())
                .then(data => updateDashboardWithData(data));
        }

        function updateDashboardWithData(data) {
            // Actualizar estad√≠sticas
            document.getElementById('totalRecords').textContent = data.total_records;
            document.getElementById('uniqueEmployees').textContent = data.unique_employees;
            
            // Actualizar estado de conexi√≥n
            updateConnectionStatus(data.connected);
            updateMonitoringStatus(data.monitoring);
            
            // Actualizar empleados dentro
            const insideDiv = document.getElementById('employeesInside');
            const insideCount = document.getElementById('insideCount');
            insideCount.textContent = data.employees_inside.length;
            
            if (data.employees_inside.length === 0) {
                insideDiv.innerHTML = '<div class="employee-item" style="text-align: center; color: #64748b; padding: 2rem;"><div>üè† Todos los empleados est√°n fuera</div></div>';
            } else {
                insideDiv.innerHTML = data.employees_inside.map(emp => `
                    <div class="employee-item">
                        <div>
                            <div class="employee-name status-inside">üü¢ ${emp.name}</div>
                            <div class="employee-time">ID: ${emp.id}</div>
                        </div>
                        <div class="employee-time">${emp.time ? new Date(emp.time).toLocaleTimeString() : ''}</div>
                    </div>
                `).join('');
            }
            
            // Actualizar empleados fuera
            const outsideDiv = document.getElementById('employeesOutside');
            const outsideCount = document.getElementById('outsideCount');
            outsideCount.textContent = data.employees_outside.length;
            
            if (data.employees_outside.length === 0) {
                outsideDiv.innerHTML = '<div class="employee-item" style="text-align: center; color: #64748b; padding: 2rem;"><div>üè¢ Todos los empleados est√°n dentro</div></div>';
            } else {
                outsideDiv.innerHTML = data.employees_outside.map(emp => `
                    <div class="employee-item">
                        <div>
                            <div class="employee-name status-outside">üî¥ ${emp.name}</div>
                            <div class="employee-time">ID: ${emp.id}</div>
                        </div>
                        <div class="employee-time">${emp.time ? new Date(emp.time).toLocaleTimeString() : 'Sin registro'}</div>
                    </div>
                `).join('');
            }
            
            // Solo actualizar registros si no hay nuevos registros en tiempo real
            if (!document.querySelector('.new-record')) {
                const recordsDiv = document.getElementById('recordsList');
                if (data.recent_records.length === 0) {
                    recordsDiv.innerHTML = '<div class="record-item">No hay registros recientes</div>';
                } else {
                    recordsDiv.innerHTML = data.recent_records.map(record => {
                        const eventIcon = record[1] === 'entrada' ? 'üü¢' : 'üî¥';
                        const eventColor = record[1] === 'entrada' ? '#10b981' : '#ef4444';
                        const eventBg = record[1] === 'entrada' ? 'linear-gradient(135deg, #10b981, #059669)' : 'linear-gradient(135deg, #ef4444, #dc2626)';
                        const recordBg = record[1] === 'entrada' ? '#f0fdf4' : '#fef2f2';
                        return `
                            <div class="record-item" style="border-left: 5px solid ${eventColor}; background: ${recordBg};">
                                <div class="record-header">
                                    <span class="record-name">${eventIcon} ${record[0]}</span>
                                    <span class="record-event" style="background: ${eventBg}; color: white;">
                                        ${record[1].toUpperCase()}
                                    </span>
                                </div>
                                <div class="record-details">
                                    <span>üìÖ ${new Date(record[2]).toLocaleDateString()}</span>
                                    <span>‚è∞ ${new Date(record[2]).toLocaleTimeString()}</span>
                                    <span>üëÜ ${record[3]}</span>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            }
        }

        function addNewRecord(data) {
            const recordsDiv = document.getElementById('recordsList');
            
            // Remover mensaje de "esperando registros" si existe
            const waitingMsg = recordsDiv.querySelector('.record-item');
            if (waitingMsg && waitingMsg.textContent.includes('Esperando registros')) {
                recordsDiv.innerHTML = '';
            }
            
            const newRecord = document.createElement('div');
            newRecord.className = 'record-item new-record';
            
            // Determinar √≠cono y color seg√∫n el tipo de evento
            const eventIcon = data.event_type === 'entrada' ? 'üü¢' : 'üî¥';
            const eventColor = data.event_type === 'entrada' ? '#28a745' : '#dc3545';
            
            // Mostrar informaci√≥n del departamento si es Reacondicionamiento
            const deptInfo = (data.department === 'Reacondicionamiento' || data.schedule === 'reacondicionamiento') 
                ? ' <span style="font-size: 0.8em; color: #6f42c1;">[REACONDICIONAMIENTO]</span>' 
                : '';
            
            newRecord.innerHTML = `
                <div class="record-header">
                    <span class="record-name">${eventIcon} ${data.name}${deptInfo}</span>
                    <span class="record-event" style="background: ${eventColor}; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem;">
                        ${data.event_type.toUpperCase()}
                    </span>
                </div>
                <div class="record-details">
                    üìÖ ${new Date(data.timestamp).toLocaleDateString()} ‚è∞ ${new Date(data.timestamp).toLocaleTimeString()} | üëÜ ${data.verify_method}
                </div>
            `;
            
            // Agregar efecto de resaltado
            newRecord.style.borderLeft = `4px solid ${eventColor}`;
            newRecord.style.backgroundColor = data.event_type === 'entrada' ? '#d4edda' : '#f8d7da';
            
            recordsDiv.insertBefore(newRecord, recordsDiv.firstChild);
            
            // Animar el nuevo registro
            setTimeout(() => {
                newRecord.style.backgroundColor = 'white';
            }, 3000);
            
            // Mantener solo los √∫ltimos 15 registros
            while (recordsDiv.children.length > 15) {
                recordsDiv.removeChild(recordsDiv.lastChild);
            }
            
            // Mostrar notificaci√≥n
            showNotification(`${eventIcon} ${data.name} - ${data.event_type.toUpperCase()}`, 'info');
        }

        function addDeniedRecord(data) {
            const recordsDiv = document.getElementById('recordsList');
            const newRecord = document.createElement('div');
            newRecord.className = 'record-item new-record';
            newRecord.style.borderLeft = '4px solid #dc3545';
            newRecord.innerHTML = `
                <div class="record-header">
                    <span class="record-name">ID: ${data.employee_id}</span>
                    <span class="record-event" style="background: #f8d7da; color: #721c24;">‚ùå DENEGADO</span>
                </div>
                <div class="record-details">
                    ${new Date(data.timestamp).toLocaleString()} | ${data.verify_method}
                </div>
            `;
            recordsDiv.insertBefore(newRecord, recordsDiv.firstChild);
            
            // Mantener solo los √∫ltimos 10 registros
            while (recordsDiv.children.length > 10) {
                recordsDiv.removeChild(recordsDiv.lastChild);
            }
        }

        function updateConnectionStatus(connected) {
            const statusDot = document.getElementById('connectionStatus');
            const statusText = document.getElementById('connectionText');
            
            if (connected) {
                statusDot.className = 'status-dot connected';
                statusText.textContent = 'Dispositivo conectado';
            } else {
                statusDot.className = 'status-dot disconnected';
                statusText.textContent = 'Dispositivo desconectado';
            }
        }

        function updateMonitoringStatus(monitoring) {
            const statusDot = document.getElementById('monitoringStatus');
            const statusText = document.getElementById('monitoringText');
            const monitorBtn = document.getElementById('monitorBtn');
            
            isMonitoring = monitoring;
            
            if (monitoring) {
                statusDot.className = 'status-dot monitoring';
                statusText.textContent = 'Monitoreando activamente';
                monitorBtn.innerHTML = '‚è∏Ô∏è Detener Monitoreo';
                monitorBtn.className = 'btn btn-warning';
            } else {
                statusDot.className = 'status-dot disconnected';
                statusText.textContent = 'Monitoreo detenido';
                monitorBtn.innerHTML = '‚ñ∂Ô∏è Iniciar Monitoreo';
                monitorBtn.className = 'btn btn-success';
            }
        }

        function showAddEmployeeModal() {
            document.getElementById('addEmployeeModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('addEmployeeModal').style.display = 'none';
            document.getElementById('addEmployeeForm').reset();
        }

        function toggleMonitoring() {
            const endpoint = isMonitoring ? '/api/stop_monitoring' : '/api/start_monitoring';
            
            fetch(endpoint, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    showNotification(data.message, 'info');
                    setTimeout(loadDashboardData, 1000);
                });
        }

        function testConnection() {
            fetch('/api/test_connection', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    const message = data.connected ? 'Conexi√≥n exitosa' : 'Error de conexi√≥n';
                    const type = data.connected ? 'success' : 'error';
                    showNotification(message, type);
                    loadDashboardData();
                });
        }

        function syncEmployees() {
            fetch('/api/sync_employees', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    showNotification(data.message, data.success ? 'success' : 'error');
                    if (data.success) {
                        loadDashboardData();
                    }
                });
        }

        // Formulario agregar empleado
        document.getElementById('addEmployeeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                employee_id: document.getElementById('employeeId').value,
                name: document.getElementById('employeeName').value,
                department: document.getElementById('employeeDept').value,
                phone: document.getElementById('employeePhone').value,
                email: document.getElementById('employeeEmail').value,
                sync_to_device: document.getElementById('syncToDevice').checked
            };
            
            fetch('/api/add_employee', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                showNotification(data.message, data.success ? 'success' : 'error');
                if (data.success) {
                    closeModal();
                    loadDashboardData();
                }
            });
        });

        function showNotification(message, type) {
            // Remover notificaciones existentes
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notif => {
                if (document.body.contains(notif)) {
                    document.body.removeChild(notif);
                }
            });
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = message;
            notification.style.animation = 'slideIn 0.3s ease-out';
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    notification.style.animation = 'slideOut 0.3s ease-in';
                    setTimeout(() => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }
            }, 3000);
        }

        // Cerrar modal al hacer clic fuera
        window.onclick = function(event) {
            const modal = document.getElementById('addEmployeeModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        function updateDateTime() {
            const now = new Date();
            
            // Actualizar fecha y hora en el header
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            const dateTimeStr = now.toLocaleDateString('es-ES', options);
            document.getElementById('currentDateTime').textContent = dateTimeStr;
            
            // Actualizar reloj en el dashboard
            const timeStr = now.toLocaleTimeString('es-ES', {hour: '2-digit', minute: '2-digit', second: '2-digit'});
            const dateStr = now.toLocaleDateString('es-ES', {weekday: 'long', day: 'numeric', month: 'long'});
            
            const timeEl = document.getElementById('currentTime');
            const dateEl = document.getElementById('currentDate');
            
            if (timeEl) timeEl.textContent = timeStr;
            if (dateEl) dateEl.textContent = dateStr;
        }

        // Inicializar fecha/hora
        updateDateTime();
        setInterval(updateDateTime, 1000);

        // Auto-refresh cada 30 segundos (los eventos en tiempo real llegan por WebSocket)
        setInterval(loadDashboardData, 30000);
        
        // Limpiar registros antiguos cada 5 minutos
        setInterval(() => {
            const recordsDiv = document.getElementById('recordsList');
            while (recordsDiv.children.length > 20) {
                recordsDiv.removeChild(recordsDiv.lastChild);
            }
        }, 300000);
    </script>
</body>
</html>